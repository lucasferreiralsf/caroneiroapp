kind: pipeline
type: docker
name: default

platform:
  os: linux
  arch: amd64

# workspace:
#   base: /go
#   path: src/github.com/caroneiroapp/app

steps:
# - name: backend
#   image: docker/compose
#   volumes:
#   - name: docker_sock
#     path: /var/run/docker.sock
#   commands:
#     - docker-compose -f docker-compose-prod.yml up --force-recreate -d caroneiro_api

# - name: build
#   image: docker
#   commands:
#     - docker build -t some/container .
#   volumes:
#     - name: docker_sock
#       path: /var/run/docker.sock

- name: deploy
  image: compose:1.25.0-rc2
  volumes:
    - name: docker_sock
      path: /var/run/docker.sock
    # - name: dockersock
    #   path: /var/run
  commands:
    - up -f docker-compose-prod.yml --force-recreate -d

# services:
# - name: docker
#   image: docker:dind
#   privileged: true
#   volumes:
#   - name: dockersock
#     path: /var/run

volumes:
  - name: docker_sock
    host:
      path: /var/run/docker.sock
  # - name: dockersock
  #   temp: {}

trigger:
  branch:
    - NestJS-V2